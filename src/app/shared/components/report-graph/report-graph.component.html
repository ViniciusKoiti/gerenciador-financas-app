<mat-accordion>
  <mat-expansion-panel [expanded]="true">
    <mat-expansion-panel-header>
      <div class="flex items-center">
        <mat-icon class="mr-2 text-gray-700">dashboard</mat-icon>
        <h2 class="text-2xl font-bold text-gray-900">Dashboard Financeiro</h2>
      </div>
    </mat-expansion-panel-header>

    <!-- Filtros -->
    <div class="filter-section p-4 bg-gray-50 rounded-lg mb-6">
      <h3 class="filter-title text-lg font-medium text-gray-700 mb-3">Filtros</h3>

      <form [formGroup]="filterForm" class="filter-form">
        <div class="row flex flex-wrap gap-4">
          <mat-form-field appearance="outline" class="w-48">
            <mat-label>Período</mat-label>
            <mat-select formControlName="dateRange">
              <mat-option *ngFor="let option of dateRangeOptions" [value]="option.value">
                {{ option.label }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <div class="custom-date-range flex flex-wrap gap-4" *ngIf="showCustomDateRange">
            <mat-form-field appearance="outline">
              <mat-label>Data Inicial</mat-label>
              <input
                matInput
                [matDatepicker]="startPicker"
                formControlName="startDate"
                placeholder="DD/MM/AAAA"
              >
              <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
              <mat-datepicker #startPicker></mat-datepicker>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Data Final</mat-label>
              <input
                matInput
                [matDatepicker]="endPicker"
                formControlName="endDate"
                placeholder="DD/MM/AAAA"
              >
              <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
              <mat-datepicker #endPicker></mat-datepicker>
            </mat-form-field>

            <div class="flex items-end">
              <app-custom-button
                text="Filtrar"
                type="button"
                variant="primary"
                [isGradient]="true"
                [customClasses]="'border-0 hover:bg-white transition-colors'"
                (buttonClick)="applyCustomFilter()">
              </app-custom-button>
            </div>
          </div>
        </div>

        <div class="action-buttons mt-4">
          <button mat-stroked-button (click)="resetFilters()">
            <mat-icon>refresh</mat-icon> Limpar Filtros
          </button>
        </div>
      </form>
    </div>

    <div class="loading-indicator flex flex-col items-center justify-center py-12" *ngIf="isLoading">
      <mat-spinner diameter="40"></mat-spinner>
      <span class="mt-4 text-gray-600">Carregando dados...</span>
    </div>

    <div class="no-data-message flex items-center justify-center p-8 bg-gray-50 rounded-lg" *ngIf="noDataMessage && !isLoading">
      <mat-icon class="mr-2 text-amber-500">info</mat-icon>
      <span class="text-gray-700">{{ noDataMessage }}</span>
    </div>

    <div class="dashboard-content" *ngIf="!isLoading && !noDataMessage">
      <div class="summary-cards grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
        <mat-card class="bg-blue-50">
          <mat-card-content>
            <div class="flex flex-col">
              <span class="text-sm font-medium text-blue-800 mb-1">Total de Receitas</span>
              <span class="text-2xl font-bold text-blue-600">
                {{ formatCurrency(resumoFinanceiro.totalReceitas) }}
              </span>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card class="bg-red-50">
          <mat-card-content>
            <div class="flex flex-col">
              <span class="text-sm font-medium text-red-800 mb-1">Total de Despesas</span>
              <span class="text-2xl font-bold text-red-600">
                {{ formatCurrency(resumoFinanceiro.totalDespesas) }}
              </span>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card [ngClass]="resumoFinanceiro.saldoTotal >= 0 ? 'bg-green-50' : 'bg-orange-50'">
          <mat-card-content>
            <div class="flex flex-col">
              <span class="text-sm font-medium"
                    [ngClass]="resumoFinanceiro.saldoTotal >= 0 ? 'text-green-800' : 'text-orange-800'">
                Saldo Total
              </span>
              <span class="text-2xl font-bold"
                    [ngClass]="resumoFinanceiro.saldoTotal >= 0 ? 'text-green-600' : 'text-orange-600'">
                {{ formatCurrency(resumoFinanceiro.saldoTotal) }}
              </span>
            </div>
          </mat-card-content>
        </mat-card>
      </div>

      <!-- Gráfico de Barras - Receitas vs Despesas -->
      <div class="chart-section">
        <h3 class="text-lg font-medium text-gray-700 mb-3">Receitas vs Despesas</h3>
        <div class="chart-wrapper bg-gray-50 p-6 rounded-lg" style="height: 400px; min-height: 350px;">
          <!-- Loading state -->
          <div *ngIf="isLoading" class="flex items-center justify-center h-full">
            <mat-spinner diameter="40"></mat-spinner>
          </div>
          
          <!-- No data state -->
          <div *ngIf="!isLoading && (noDataMessage || !(barChartData?.datasets?.[0]?.data?.length))" 
               class="flex items-center justify-center h-full">
            <span class="text-gray-500">
              {{ noDataMessage || 'Sem dados para exibir' }}
            </span>
          </div>
          
          <!-- Chart display -->
          <div *ngIf="!isLoading && !noDataMessage && (barChartData?.datasets?.[0]?.data?.length || 0) > 0 && chartsInitialized"
               class="h-full w-full position-relative">
            <canvas
              baseChart
              #barChart
              [type]="'bar'"
              [data]="barChartData"
              [options]="barChartOptions">
            </canvas>
          </div>
        </div>
      </div>
    </div>
  </mat-expansion-panel>
</mat-accordion>
